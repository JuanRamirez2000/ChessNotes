// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
    provider     = "mysql"
    url          = env("DATABASE_URL")
    relationMode = "prisma"
}

generator client {
    provider = "prisma-client-js"
}

model ChessUserProfile {
    playerId Int     @id @unique
    username String  @unique
    title    String?
    fide     Int

    userPlayerProfile ChessComPlayer?
    userNotebooks     ChessNotebook[]
    userGames         ChessComGame[]

    @@index([username])
}

model ChessComPlayer {
    id       String @id
    rating   String
    username String @unique
    uuid     String

    chessUser ChessUserProfile @relation(fields: [username], references: [username])

    @@index([username])
}

model ChessNotebook {
    id        Int           @id @default(autoincrement())
    createdAt DateTime      @default(now())
    updatedAt DateTime      @updatedAt
    title     String?
    notes     String?
    gameId    ChessComGame?

    notebookAuthor ChessUserProfile @relation(fields: [authorUsername], references: [username])
    authorUsername String

    @@index([authorUsername])
}

model ChessComGame {
    url         String                 @id @unique()
    fen         String
    pgn         String
    rated       String
    timeClass   String
    timeControl String
    uuid        String
    accuracies  ChessPlayerAccuracies?

    gamePlayer ChessUserProfile[]
    notebook   ChessNotebook      @relation(fields: [notebookId], references: [id])
    notebookId Int                @unique

    @@index([url])
}

model ChessPlayerAccuracies {
    id     String       @id
    black  Int
    white  Int
    gameID ChessComGame @relation(fields: [id], references: [url])

    @@index([id])
}

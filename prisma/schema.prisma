// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
    provider     = "mysql"
    url          = env("DATABASE_URL")
    relationMode = "prisma"
}

generator client {
    provider = "prisma-client-js"
}

model ChessUserProfile {
    username  String  @id @unique
    playerId  String  @unique
    avatarURL String?
    title     String?
    fide      Int?

    //userPlayerProfile ChessComPlayer?
    userNotebooks ChessNotebook[]
    //userGames         ChessComGame[]

    @@index([username])
}

model ChessComPlayer {
    username String  @id @unique
    rating   Int?
    uuid     String?

    games ChessComPlayersInGame[]

    //chessUser ChessUserProfile @relation(fields: [username], references: [username])

    @@index([username])
}

model ChessNotebook {
    id        Int           @id @default(autoincrement())
    createdAt DateTime      @default(now())
    updatedAt DateTime      @updatedAt
    title     String?
    notes     String?
    gameId    ChessComGame?

    notebookAuthor ChessUserProfile @relation(fields: [authorUsername], references: [username])
    authorUsername String

    @@index([authorUsername])
}

model ChessComGame {
    url              String                  @id
    fen              String?
    pgn              String?                 @db.Text
    rated            Boolean?
    timeClass        String?
    timeControl      String?
    playerAccuracies ChessPlayerAccuracies?
    players          ChessComPlayersInGame[]

    notebook   ChessNotebook? @relation(fields: [notebookId], references: [id])
    notebookId Int?           @unique

    @@index([url])
}

model ChessComPlayersInGame {
    game     ChessComGame   @relation(fields: [gameId], references: [url])
    gameId   String
    player   ChessComPlayer @relation(fields: [playerId], references: [username])
    playerId String

    @@id([gameId, playerId])
    @@index([playerId])
}

model ChessPlayerAccuracies {
    id     String        @id
    black  Float?
    white  Float?
    gameID ChessComGame? @relation(fields: [id], references: [url])

    @@index([id])
}
